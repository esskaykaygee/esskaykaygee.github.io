<!doctype html>
<html lang="en">
  <head>
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png" />
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png" />
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png" />
    <link rel="manifest" href="/site.webmanifest" />

    <meta charset="UTF-8" />
    <title>who are you?</title>
    <link rel="stylesheet" href="styles.css" />
  </head>
  <body>
    <div class="login-container">
      <h1>who are you?</h1>
      <p>your first and last name please</p>
      <input type="text" id="username" placeholder="Enter your name" />
      <button id="enterBtn">Enter</button>
      <p id="error" style="color: red; display: none">Name not recognized!</p>
    </div>

    <script type="module">
      import { supabase } from "./supabase.js";

      const usernameInput = document.getElementById("username");
      const enterBtn = document.getElementById("enterBtn");
      const errorText = document.getElementById("error");

      enterBtn.addEventListener("click", async () => {
        const name = usernameInput.value.trim();
        if (!name) return;

        const { data, error } = await supabase
          .from("allowed_names")
          .select("*")
          .ilike("name", `%${name}%`);

        if (error) {
          console.error("Supabase Error:", error);
          return;
        }

        console.log("Database response:", data);

        if (data && data.length > 0) {
          localStorage.setItem("username", data[0].name);

          window.location.href = "index.html";
        } else {
          errorText.style.display = "block";
        }
      });
    </script>
  </body>
</html>
