<!doctype html>
<html lang="en">
  <head>
    <meta
      name="google-site-verification"
      content="YB0ab-PmliaxC-Zd7oAxyyJSRAsBF-903VDlOvG9Ww0"
    />
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png" />
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png" />
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png" />
    <link rel="manifest" href="/site.webmanifest" />

    <meta charset="UTF-8" />
    <title>Who are you?</title>
    <link rel="stylesheet" href="styles.css" />
  </head>
  <body>
    <div class="login-container">
      <h1>who are you?</h1>
      <p>your first and last name please</p>
      <input type="text" id="username" placeholder="Enter your name" />
      <button id="enterBtn">Enter</button>
      <p id="error" style="color: red; display: none"></p>
    </div>

    <script type="module">
      import { supabase } from "./supabase.js";

      const usernameInput = document.getElementById("username");
      const enterBtn = document.getElementById("enterBtn");
      const errorText = document.getElementById("error");

      enterBtn.addEventListener("click", async () => {
        const inputName = usernameInput.value.trim();
        errorText.style.display = "none";

        // Require first + last name
        if (!inputName.includes(" ")) {
          errorText.textContent = "Please enter your first and last name.";
          errorText.style.display = "block";
          return;
        }

        const { data, error } = await supabase
          .from("allowed_names")
          .select("name")
          .ilike("name", inputName); // exact match, case-insensitive

        if (error) {
          console.error("Supabase Error:", error);
          errorText.textContent = "Database error. Try again later.";
          errorText.style.display = "block";
          return;
        }

        if (data && data.length === 1) {
          // Store canonical full name from DB
          localStorage.setItem("username", data[0].name);
          window.location.href = "index.html";
        } else {
          errorText.textContent = "Name not recognized!";
          errorText.style.display = "block";
        }
      });
    </script>
  </body>
</html>
